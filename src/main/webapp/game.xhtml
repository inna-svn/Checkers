<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
>
<h:head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title><ui:insert name="title">Checkers</ui:insert></title>
    <!-- Does not work. To fix.  -->
    <link rel="stylesheet" href="main.css"/>

</h:head>
<h:body>

    <h1>Playing #{gameEndpoint.game.name}</h1>


    <!-- https://javaee.github.io/tutorial/jsf-ws003.html -->
    <!-- https://javaee.github.io/javaee-spec/javadocs/javax/faces/push/Push.html -->
    <!-- TOOD: By game ID and user ID, not game name and user name -->
    <!-- Warning: ajax tag does not work -->
    <f:websocket channel="game" user="#{userSession.lobby.gameName}_#{userSession.username}" onmessage="onMessage" />

    <script>
        // WIP
        function onMessage(message, channel, messageEvent) {
            console.debug('onMessage', message, channel, messageEvent);
            window[message.func](...message.args);
        }

    </script>

    <h2>Board</h2>
    <table>
        <ui:repeat value="#{gameEndpoint.getBoardLocations(userSession.user)}" var="row">
            <tr>
                <ui:repeat value="${row}" var="bl">
                    <td class="#{bl.location.color}-background">
                        <h:outputText rendered="${bl.piece == null}">
                            -
                        </h:outputText>
                        <h:outputText rendered="${bl.piece.color == 'BLACK'}">
                            <img src="Images/blackPiece.jpg"/>
                        </h:outputText>
                        <h:outputText rendered="${bl.piece.color == 'WHITE'}">
                            <img src="Images/whitePiece.jpg"/>
                        </h:outputText>
                    </td>
                </ui:repeat>
            </tr>
        </ui:repeat>
    </table>

    <h:outputText rendered="${gameEndpoint.game.activeUser == userSession.user}">
        your turn
    </h:outputText>

</h:body>
</html>